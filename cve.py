#!/usr/bin/env python
import argparse
import urllib2
import re
from bs4 import BeautifulSoup

#currently doesn't take distro flag, hard coded to 10.04
#breaks on cves with multiple packages, for example #CVE-2011-2483

urlbase = 'http://people.canonical.com/~ubuntu-security/cve/'
parser = argparse.ArgumentParser(description='Ubuntu CVE lookup tool')

parser.add_argument('-c',
                    dest='cve',
                    action='store',
                    help='Lookup CVE'
                   )
parser.add_argument('-v',
                    dest='distro',
                    action='store',
                    help='Ubuntu distro'
                   )

args = parser.parse_args()

cve = args.cve
date = cve.split('-')

website = urlbase + date[1] + '/' + cve + '.html'

print cve
print website

url = urllib2.urlopen(website)
website_html = url.read()

soup = BeautifulSoup(website_html.encode('utf-8', 'ignore'))
#package = soup.find_all('div')
package = soup.find_all("div", { "class" : "value" })
for items in package:
  match = re.search(r"Source", items.get_text())
  if match:
    print items.text

refs = soup.find_all('tr')

for items in refs:
  match = re.search(r"Lucid", items.text)
  if match:
    print items.text

